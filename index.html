<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Shitty Volume Slider</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 32px; }
    .row { display: flex; align-items: center; gap: 12px; margin-top: 16px; }
    input[type="range"] { width: 360px; }
    .tooltip { width: 48px; text-align: right; }
    .note { font-size: 12px; opacity: 0.7; margin-top: 8px; }
    #start {
      font-size: 16px; padding: 10px 16px; cursor: pointer;
      border: 1px solid #999; background: #f6f6f6; border-radius: 8px;
    }
    #start:disabled { opacity: 0.7; cursor: default; }
  </style>
</head>
<body>
  <h1>Shitty Volume</h1>
  <button id="start">Start</button>

  <div class="row">
    <input id="vol" type="range" min="0" max="100" value="70" step="1" />
    <div id="tooltip" class="tooltip">70%</div>
  </div>
  <div class="note">cringe af</div>
  
  <!-- Official YouTube embed for Rick Astley - Never Gonna Give You Up -->
  <div id="yt-container" style="margin-top:16px;">
    <div id="ytplayer"></div>
  </div>
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    (function () {
      const slider = document.getElementById('vol');
      const tip = document.getElementById('tooltip');
      const start = document.getElementById('start');
      let player = null;
      let playerReady = false;
      let currentVolume = 0.5; // 0..1, used for dead zone memory

      // YouTube IFrame API bootstraps this global callback
      window.onYouTubeIframeAPIReady = function () {
        player = new YT.Player('ytplayer', {
          height: '202',
          width: '360',
          videoId: 'dQw4w9WgXcQ',
          playerVars: {
            autoplay: 0,
            controls: 1,
            rel: 0,
            modestbranding: 1,
            loop: 1,
            // loop requires playlist to be the same video id
            playlist: 'dQw4w9WgXcQ'
          },
          events: {
            onReady: () => {
              playerReady = true;
              // Initialize player volume from the slider using our mapping
              const initV = shittyMap(Number(slider.value));
              currentVolume = initV;
              player.setVolume(Math.round(initV * 100));
            }
          }
        });
      };

      function shittyMap(val) {
        const x = val / 100;        // 0..1
        let v = x;                  // normal direction: 0% left -> 100% right
        if (x > 0.35 && x < 0.65) v = currentVolume;  // dead zone holds previous actual volume
        v = Math.pow(v, 0.35);      // nonlinear (too loud early)
        if (Math.random() < 0.15) v = v < 0.5 ? 1 : 0; // random snap
        return Math.max(0, Math.min(1, v));
      }

      function updateFakeTooltip(val) {
        const drift = Math.round(val + (Math.random() * 14 - 7));
        tip.textContent = Math.max(0, Math.min(100, drift)) + '%';
      }

      let pending;
      slider.addEventListener('input', (e) => {
        const val = Number(e.target.value);
        updateFakeTooltip(val);
        clearTimeout(pending);
        pending = setTimeout(() => {
          const v = shittyMap(val);
          currentVolume = v;
          if (playerReady) {
            player.setVolume(Math.round(v * 100));
          }
        }, 250 + Math.random() * 400); // laggy update
      });

      // Slider nudges on hover
      slider.addEventListener('mouseenter', () => {
        const n = Number(slider.value);
        slider.value = Math.max(0, Math.min(100, n + (Math.random() * 20 - 10)));
        updateFakeTooltip(Number(slider.value));
      });

      // Tick down 1% every second after Start
      let tickTimer = null;
      function startTickDown() {
        if (tickTimer) return;
        tickTimer = setInterval(() => {
          let n = Number(slider.value);
          if (n <= 0) {
            clearInterval(tickTimer);
            tickTimer = null;
            return;
          }
          n = n - 1;
          slider.value = String(n);
          // Reflect the change with the same laggy behavior
          const v = Number(slider.value);
          updateFakeTooltip(v);
          clearTimeout(pending);
          pending = setTimeout(() => {
            const vv = shittyMap(v);
            currentVolume = vv;
            if (playerReady) {
              player.setVolume(Math.round(vv * 100));
            }
          }, 250 + Math.random() * 400);
        }, 1000);
      }

      // Start button: user gesture to play, then begin ticking
      start.addEventListener('click', async () => {
        start.disabled = true;
        start.textContent = 'Starting...';
        const boot = () => {
          if (playerReady) {
            // Ensure volume reflects current slider via mapping
            const v = shittyMap(Number(slider.value));
            currentVolume = v;
            player.setVolume(Math.round(v * 100));
            player.playVideo();
            return true;
          }
          return false;
        };
        if (!boot()) {
          const tm = setInterval(() => { if (boot()) clearInterval(tm); }, 100);
        }
        start.remove();
        startTickDown();
      });
    })();
  </script>
</body>
</html>
