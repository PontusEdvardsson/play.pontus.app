<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Shitty Volume Slider</title>
  <style>
    :root {
      --bg: #0d1117;
      --panel: #0d1117;
      --fg: #c9d1d9;
      --muted: #8b949e;
      --border: #30363d;
      --accent: #58a6ff;
      --btn-bg: #21262d;
      --btn-bg-hover: #30363d;
      --thumb: #58a6ff;
      --track: #30363d;
      --track-fill: #1f6feb;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      /* Nudge the content slightly upward for nicer balance */
      transform: translateY(-6vh);
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px 28px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.02) inset;
    }

    h1 { margin: 0 0 12px; font-size: 20px; font-weight: 600; }

    .row { display: flex; align-items: center; gap: 12px; margin-top: 16px; }

    .tooltip { width: 48px; text-align: right; color: var(--muted); }
    .note { font-size: 12px; color: var(--muted); margin-top: 8px; }

    #start {
      font-size: 14px; padding: 10px 16px; cursor: pointer;
      border: 1px solid var(--border); background: var(--btn-bg); border-radius: 8px;
      color: var(--fg);
    }
    #start:hover { background: var(--btn-bg-hover); }
    #start:disabled { opacity: 0.6; cursor: default; }

    input[type="range"] { width: 360px; height: 24px; }
    input[type="range"] {
      -webkit-appearance: none;
      background: transparent;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: var(--track);
      border-radius: 999px;
    }
    input[type="range"]::-moz-range-track {
      height: 6px; background: var(--track); border-radius: 999px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      margin-top: -6px;
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--thumb); border: 2px solid #1b4b91;
      box-shadow: 0 0 0 4px rgba(88, 166, 255, 0.15);
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--thumb); border: 2px solid #1b4b91; cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Shitty Volume</h1>
      <button id="start">Start</button>

      <div class="row">
        <input id="vol" type="range" min="0" max="100" value="70" step="1" />
        <div id="tooltip" class="tooltip">70%</div>
      </div>
      <div class="note">cringe af</div>

      <!-- Hidden audio; ensure rick.mp3 exists next to this file -->
      <audio id="rick" src="rick.mp3" preload="auto" loop></audio>
    </div>
  </div>

  <script>
    (function () {
      const slider = document.getElementById('vol');
      const tip = document.getElementById('tooltip');
      const start = document.getElementById('start');
      const audio = document.getElementById('rick');
      let currentVolume = 0.5; // 0..1, used for dead zone memory

      function shittyMap(val) {
        const x = val / 100;        // 0..1
        let v = x;                  // normal direction: 0% left -> 100% right
        if (x > 0.35 && x < 0.65) v = currentVolume;  // dead zone holds previous actual volume
        v = Math.pow(v, 0.35);      // nonlinear (too loud early)
        if (Math.random() < 0.15) v = v < 0.5 ? 1 : 0; // random snap
        return Math.max(0, Math.min(1, v));
      }

      function updateFakeTooltip(val) {
        const drift = Math.round(val + (Math.random() * 14 - 7));
        tip.textContent = Math.max(0, Math.min(100, drift)) + '%';
      }

      // Initialize audio volume to mapped slider value
      (function initVolume() {
        const initV = shittyMap(Number(slider.value));
        currentVolume = initV;
        audio.volume = initV;
      })();

      let pending;
      slider.addEventListener('input', (e) => {
        const val = Number(e.target.value);
        updateFakeTooltip(val);
        clearTimeout(pending);
        pending = setTimeout(() => {
          const v = shittyMap(val);
          currentVolume = v;
          audio.volume = v;
        }, 250 + Math.random() * 400); // laggy update
      });

      // Slider nudges on hover
      slider.addEventListener('mouseenter', () => {
        const n = Number(slider.value);
        slider.value = Math.max(0, Math.min(100, n + (Math.random() * 20 - 10)));
        updateFakeTooltip(Number(slider.value));
      });

      // Tick down 1% every second after Start
      let tickTimer = null;
      function startTickDown() {
        if (tickTimer) return;
        tickTimer = setInterval(() => {
          let n = Number(slider.value);
          if (n <= 0) {
            clearInterval(tickTimer);
            tickTimer = null;
            return;
          }
          n = n - 1;
          slider.value = String(n);
          // Reflect the change with the same laggy behavior
          const v = Number(slider.value);
          updateFakeTooltip(v);
          clearTimeout(pending);
          pending = setTimeout(() => {
            const vv = shittyMap(v);
            currentVolume = vv;
            audio.volume = vv;
          }, 250 + Math.random() * 400);
        }, 1000);
      }

      // Start button: user gesture to play, then begin ticking
      start.addEventListener('click', async () => {
        start.disabled = true;
        start.textContent = 'Starting...';

        // Ensure volume reflects current slider via mapping
        const v = shittyMap(Number(slider.value));
        currentVolume = v;
        audio.volume = v;

        try {
          await audio.play();
        } catch (err) {
          // If autoplay policy blocks, re-enable button with hint
          start.disabled = false;
          start.textContent = 'Play failed. Try again';
          return;
        }

        start.remove();
        startTickDown();
      });

      // Optional: basic error surfacing if the file is missing
      audio.addEventListener('error', () => {
        const msg = document.createElement('div');
        msg.className = 'note';
        msg.textContent = 'Could not load rick.mp3. Place it next to index.html';
        document.querySelector('.panel').appendChild(msg);
      });
    })();
  </script>
</body>
</html>
