<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Shitty Volume Slider</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 32px; }
    .row { display: flex; align-items: center; gap: 12px; }
    input[type="range"] { width: 320px; transform: scaleX(-1) rotate(1deg); }
    .tooltip { width: 48px; text-align: right; }
    .note { font-size: 12px; opacity: 0.7; }
  </style>
</head>
<body>
  <h1>Shitty Volume</h1>
  <div class="row">
    <input id="vol" type="range" min="0" max="100" value="70" step="1" />
    <div id="tooltip" class="tooltip">70%</div>
  </div>
  <div class="note">It changes after you let go. Sometimes.</div>

  <audio id="bg" src="audio/loop.mp3" loop preload="auto" muted></audio>

  <script>
    (function () {
      const audio = document.getElementById('bg');
      const slider = document.getElementById('vol');
      const tip = document.getElementById('tooltip');

      // Try to autoplay; unmute on first interaction
      (async () => {
        try {
          audio.volume = 0.5;
          await audio.play();
          window.addEventListener('pointerdown', () => (audio.muted = false), { once: true });
        } catch {
          window.addEventListener('pointerdown', () => {
            audio.play().catch(() => {});
            audio.muted = false;
          }, { once: true });
        }
      })();

      function shittyMap(val) {
        const x = val / 100;        // 0..1
        let v = 1 - x;              // reverse direction
        if (x > 0.35 && x < 0.65) v = audio.volume;  // dead zone
        v = Math.pow(v, 0.35);      // nonlinear (too loud early)
        if (Math.random() < 0.15) v = v < 0.5 ? 1 : 0; // random snap
        return Math.max(0, Math.min(1, v));
      }

      function updateFakeTooltip(val) {
        const drift = Math.round(val + (Math.random() * 14 - 7));
        tip.textContent = Math.max(0, Math.min(100, drift)) + '%';
      }

      let pending;
      slider.addEventListener('input', (e) => {
        const val = Number(e.target.value);
        updateFakeTooltip(val);
        clearTimeout(pending);
        pending = setTimeout(() => {
          audio.volume = shittyMap(val);
        }, 250 + Math.random() * 400); // laggy update
      });

      // Slider nudges on hover
      slider.addEventListener('mouseenter', () => {
        const n = Number(slider.value);
        slider.value = Math.max(0, Math.min(100, n + (Math.random() * 20 - 10)));
        updateFakeTooltip(Number(slider.value));
      });
    })();
  </script>
</body>
</html>